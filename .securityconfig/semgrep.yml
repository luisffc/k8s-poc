# Semgrep CI configuration
# Configure rules for comprehensive security scanning

rules:
  # Security audit rules
  - id: security-audit
    patterns:
      - pattern: |
          $FUNC(..., shell=True, ...)
      - pattern: |
          subprocess.$METHOD(..., shell=True, ...)
      - pattern: |
          eval($INPUT)
      - pattern: |
          exec($INPUT)
    message: "Potential security vulnerability detected"
    languages: [python]
    severity: ERROR

  # Secrets detection
  - id: hardcoded-secrets
    patterns:
      - pattern: |
          password = "$VALUE"
      - pattern: |
          api_key = "$VALUE"
      - pattern: |
          secret = "$VALUE"
      - pattern: |
          token = "$VALUE"
    message: "Potential hardcoded secret detected"
    languages: [python, yaml, dockerfile]
    severity: ERROR

# Rule sources to include
include:
  - p/security-audit      # Security vulnerabilities
  - p/secrets            # Secret detection
  - p/python             # Python-specific rules
  - p/docker             # Docker security
  - p/kubernetes         # Kubernetes security
  - p/owasp-top-ten     # OWASP Top 10 vulnerabilities
  - p/bandit            # Python security (Bandit rules)

# Paths to scan
paths:
  include:
    - "service_a/"
    - "service_b/"
    - "charts/"
    - ".github/"
    - "helm/"
  exclude:
    - "tests/"
    - "*.md"
    - ".git/"

# Output configuration
output:
  format: sarif
  destination: semgrep-results.sarif

# Performance settings
performance:
  max_memory_mb: 2048
  timeout_seconds: 300
